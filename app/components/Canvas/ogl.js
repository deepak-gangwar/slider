export const ogl=function(a){"use strict";function t(a){let b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)}function u(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a}function v(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a}function w(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a}function x(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a}function y(c,a){let d=a[0],e=a[1],f=a[2],b=d*d+e*e+f*f;return b>0&&(b=1/Math.sqrt(b)),c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b,c}function z(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}let A=function(){let a=[0,0,0],b=[0,0,0];return function(d,e){u(a,d),u(b,e),y(a,a),y(b,b);let c=z(a,b);return c>1?0:c< -1?Math.PI:Math.acos(c)}}();class b extends Array{constructor(a=0,b=a,c=a){return super(a,b,c),this}get x(){return this[0]}set x(a){this[0]=a}get y(){return this[1]}set y(a){this[1]=a}get z(){return this[2]}set z(a){this[2]=a}set(a,f=a,g=a){var b,c,d,e;return a.length?this.copy(a):(b=this,c=a,d=f,e=g,b[0]=c,b[1]=d,b[2]=e,this)}copy(a){return u(this,a),this}add(a,b){return b?v(this,a,b):v(this,this,a),this}sub(a,b){return b?w(this,a,b):w(this,this,a),this}multiply(c){var d,a,b;return c.length?(a=this,b=c,(d=this)[0]=a[0]*b[0],d[1]=a[1]*b[1],d[2]=a[2]*b[2]):x(this,this,c),this}divide(c){var d,a,b;return c.length?(a=this,b=c,(d=this)[0]=a[0]/b[0],d[1]=a[1]/b[1],d[2]=a[2]/b[2]):x(this,this,1/c),this}inverse(c=this){var b,a;return a=c,(b=this)[0]=1/a[0],b[1]=1/a[1],b[2]=1/a[2],this}len(){return t(this)}distance(f){var a,b;let c,d,e;return f?(a=this,c=(b=f)[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],Math.sqrt(c*c+d*d+e*e)):t(this)}squaredLen(){return this.squaredDistance()}squaredDistance(j){var a,c,b;let d,e,f,g,h,i;return j?(a=this,d=(c=j)[0]-a[0],e=c[1]-a[1],f=c[2]-a[2],d*d+e*e+f*f):(b=this,g=b[0],h=b[1],i=b[2],g*g+h*h+i*i)}negate(c=this){var b,a;return a=c,(b=this)[0]=-a[0],b[1]=-a[1],b[2]=-a[2],this}cross(j,k){var a,b,c;let d,e,f,g,h,i;return a=this,b=j,c=k,d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,this}scale(a){return x(this,this,a),this}normalize(){return y(this,this),this}dot(a){return z(this,a)}equals(c){var b,a;return a=c,(b=this)[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]}applyMatrix4(h){var f,g,a;let c,d,e,b;return f=this,g=this,a=h,c=g[0],d=g[1],e=g[2],b=a[3]*c+a[7]*d+a[11]*e+a[15],b=b||1,f[0]=(a[0]*c+a[4]*d+a[8]*e+a[12])/b,f[1]=(a[1]*c+a[5]*d+a[9]*e+a[13])/b,f[2]=(a[2]*c+a[6]*d+a[10]*e+a[14])/b,this}applyQuaternion(q){var h,i,a;let j,k,l,b,c,d,e,f,g,n,o,p,m;return h=this,i=this,a=q,j=i[0],k=i[1],l=i[2],b=a[0],c=a[1],d=a[2],e=c*l-d*k,f=d*j-b*l,g=b*k-c*j,n=c*g-d*f,o=d*e-b*g,p=b*f-c*e,m=2*a[3],e*=m,f*=m,g*=m,n*=2,o*=2,p*=2,h[0]=j+e+n,h[1]=k+f+o,h[2]=l+g+p,this}angle(a){return A(this,a)}lerp(h,i){var a,b,c,d;let e,f,g;return a=this,b=this,c=h,d=i,e=b[0],f=b[1],g=b[2],a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),this}clone(){return new b(this[0],this[1],this[2])}fromArray(a,b=0){return this[0]=a[b],this[1]=a[b+1],this[2]=a[b+2],this}toArray(a=[],b=0){return a[b]=this[0],a[b+1]=this[1],a[b+2]=this[2],a}transformDirection(a){let b=this[0],c=this[1],d=this[2];return this[0]=a[0]*b+a[4]*c+a[8]*d,this[1]=a[1]*b+a[5]*c+a[9]*d,this[2]=a[2]*b+a[6]*c+a[10]*d,this.normalize()}}let B=new b,C=0,D=0;class f{constructor(c,a={}){for(let b in this.gl=c,this.attributes=a,this.id=C++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state,a)this.addAttribute(b,a[b])}addAttribute(b,a){if(this.attributes[b]=a,a.id=D++,a.size=a.size||1,a.type=a.type||(a.data.constructor===Float32Array?this.gl.FLOAT:a.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),a.target="index"===b?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,a.normalize=a.normalize||!1,a.buffer=this.gl.createBuffer(),a.count=a.data.length/a.size,a.divisor=a.instanced||0,a.needsUpdate=!1,this.updateAttribute(a),a.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==a.count*a.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,a.count*a.divisor);this.instancedCount=a.count*a.divisor}else"index"===b?this.drawRange.count=a.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,a.count))}updateAttribute(a){this.glState.boundBuffer!==a.id&&(this.gl.bindBuffer(a.target,a.buffer),this.glState.boundBuffer=a.id),this.gl.bufferData(a.target,a.data,this.gl.STATIC_DRAW),a.needsUpdate=!1}setIndex(a){this.addAttribute("index",a)}setDrawRange(a,b){this.drawRange.start=a,this.drawRange.count=b}setInstancedCount(a){this.instancedCount=a}createVAO(a){this.VAOs[a.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[a.attributeOrder]),this.bindAttributes(a)}bindAttributes(a){a.attributeLocations.forEach((b,c)=>{if(!this.attributes[c])return void console.warn(`active attribute ${c} not being supplied`);let a=this.attributes[c];this.gl.bindBuffer(a.target,a.buffer),this.glState.boundBuffer=a.id,this.gl.vertexAttribPointer(b,a.size,a.type,a.normalize,0,0),this.gl.enableVertexAttribArray(b),this.gl.renderer.vertexAttribDivisor(b,a.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:a,mode:b=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${a.attributeOrder}`&&(this.VAOs[a.attributeOrder]||this.createVAO(a),this.gl.renderer.bindVertexArray(this.VAOs[a.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${a.attributeOrder}`),a.attributeLocations.forEach((c,b)=>{let a=this.attributes[b];a.needsUpdate&&this.updateAttribute(a)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(b,this.drawRange.count,this.attributes.index.type,this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(b,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(b,this.drawRange.count,this.attributes.index.type,this.drawRange.start):this.gl.drawArrays(b,this.drawRange.start,this.drawRange.count)}computeBoundingBox(d){!d&&this.attributes.position&&(d=this.attributes.position.data),d||console.warn("No position buffer found to compute bounds"),this.bounds||(this.bounds={min:new b,max:new b,center:new b,scale:new b,radius:1/0});let a=this.bounds.min,c=this.bounds.max,i=this.bounds.center,j=this.bounds.scale;a.set(1/0),c.set(-1/0);for(let e=0,k=d.length;e<k;e+=3){let f=d[e],g=d[e+1],h=d[e+2];a.x=Math.min(f,a.x),a.y=Math.min(g,a.y),a.z=Math.min(h,a.z),c.x=Math.max(f,c.x),c.y=Math.max(g,c.y),c.z=Math.max(h,c.z)}j.sub(c,a),i.add(a,c).divide(2)}computeBoundingSphere(a){!a&&this.attributes.position&&(a=this.attributes.position.data),a||console.warn("No position buffer found to compute bounds"),this.bounds||this.computeBoundingBox(a);let b=0;for(let c=0,d=a.length;c<d;c+=3)B.fromArray(a,c),b=Math.max(b,this.bounds.center.squaredDistance(B));this.bounds.radius=Math.sqrt(b)}remove(){for(let a in this.vao&&this.gl.renderer.deleteVertexArray(this.vao),this.attributes)this.gl.deleteBuffer(this.attributes[a].buffer),delete this.attributes[a]}}let E=0,F={};class h{constructor(a,{vertex:f,fragment:g,uniforms:m={},transparent:n=!1,cullFace:o=a.BACK,frontFace:p=a.CCW,depthTest:q=!0,depthWrite:r=!0,depthFunc:s=a.LESS}={}){this.gl=a,this.uniforms=m,this.id=E++,f||console.warn("vertex shader not supplied"),g||console.warn("fragment shader not supplied"),this.transparent=n,this.cullFace=o,this.frontFace=p,this.depthTest=q,this.depthWrite=r,this.depthFunc=s,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));let d=a.createShader(a.VERTEX_SHADER);a.shaderSource(d,f),a.compileShader(d),""!==a.getShaderInfoLog(d)&&console.warn(`${a.getShaderInfoLog(d)}
Vertex Shader
${H(f)}`);let e=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(e,g),a.compileShader(e),""!==a.getShaderInfoLog(e)&&console.warn(`${a.getShaderInfoLog(e)}
Fragment Shader
${H(g)}`),this.program=a.createProgram(),a.attachShader(this.program,d),a.attachShader(this.program,e),a.linkProgram(this.program),!a.getProgramParameter(this.program,a.LINK_STATUS))return console.warn(a.getProgramInfoLog(this.program));a.deleteShader(d),a.deleteShader(e),this.uniformLocations=new Map;let t=a.getProgramParameter(this.program,a.ACTIVE_UNIFORMS);for(let h=0;h<t;h++){let b=a.getActiveUniform(this.program,h);this.uniformLocations.set(b,a.getUniformLocation(this.program,b.name));let c=b.name.match(/(\w+)/g);b.uniformName=c[0],3===c.length?(b.isStructArray=!0,b.structIndex=Number(c[1]),b.structProperty=c[2]):2===c.length&&isNaN(Number(c[1]))&&(b.isStruct=!0,b.structProperty=c[1])}this.attributeLocations=new Map;let k=[],u=a.getProgramParameter(this.program,a.ACTIVE_ATTRIBUTES);for(let i=0;i<u;i++){let j=a.getActiveAttrib(this.program,i),l=a.getAttribLocation(this.program,j.name);k[l]=j.name,this.attributeLocations.set(j.name,l)}this.attributeOrder=k.join("")}setBlendFunc(a,b,c,d){this.blendFunc.src=a,this.blendFunc.dst=b,this.blendFunc.srcAlpha=c,this.blendFunc.dstAlpha=d,a&&(this.transparent=!0)}setBlendEquation(a,b){this.blendEquation.modeRGB=a,this.blendEquation.modeAlpha=b}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.blendEquation.modeRGB&&this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:a=!1}={}){let b=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((e,c)=>{let d=c.uniformName,a=this.uniforms[d];if(c.isStruct&&(a=a[c.structProperty],d+=`.${c.structProperty}`),c.isStructArray&&(a=a[c.structIndex][c.structProperty],d+=`[${c.structIndex}].${c.structProperty}`),!a)return J(`Active uniform ${d} has not been supplied`);if(a&& void 0===a.value)return J(`${d} uniform is missing a value parameter`);if(a.value.texture)return b+=1,a.value.update(b),G(this.gl,c.type,e,b);if(a.value.length&&a.value[0].texture){let f=[];return a.value.forEach(a=>{b+=1,a.update(b),f.push(b)}),G(this.gl,c.type,e,f)}G(this.gl,c.type,e,a.value)}),this.applyState(),a&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function G(b,e,c,a){a=a.length?function(a){let f=a.length,d=a[0].length;if(void 0===d)return a;let e=f*d,b=F[e];b||(F[e]=b=new Float32Array(e));for(let c=0;c<f;c++)b.set(a[c],c*d);return b}(a):a;let d=b.renderer.state.uniformLocations.get(c);if(a.length){if(void 0===d)b.renderer.state.uniformLocations.set(c,a.slice(0));else{if(function(b,c){if(b.length!==c.length)return!1;for(let a=0,d=b.length;a<d;a++)if(b[a]!==c[a])return!1;return!0}(d,a))return;d.set(a),b.renderer.state.uniformLocations.set(c,d)}}else{if(d===a)return;b.renderer.state.uniformLocations.set(c,a)}switch(e){case 5126:return a.length?b.uniform1fv(c,a):b.uniform1f(c,a);case 35664:return b.uniform2fv(c,a);case 35665:return b.uniform3fv(c,a);case 35666:return b.uniform4fv(c,a);case 35670:case 5124:case 35678:case 35680:return a.length?b.uniform1iv(c,a):b.uniform1i(c,a);case 35671:case 35667:return b.uniform2iv(c,a);case 35672:case 35668:return b.uniform3iv(c,a);case 35673:case 35669:return b.uniform4iv(c,a);case 35674:return b.uniformMatrix2fv(c,!1,a);case 35675:return b.uniformMatrix3fv(c,!1,a);case 35676:return b.uniformMatrix4fv(c,!1,a)}}function H(c){let b=c.split("\n");for(let a=0;a<b.length;a++)b[a]=a+1+": "+b[a];return b.join("\n")}let I=0;function J(a){I>100||(console.warn(a),++I>100&&console.warn("More than 100 program warnings - stopping logs."))}let K=new b;function i(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a}function j(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a}function k(b,c){let d=c[0],e=c[1],f=c[2],g=c[3],a=d*d+e*e+f*f+g*g;return a>0&&(a=1/Math.sqrt(a)),b[0]=d*a,b[1]=e*a,b[2]=f*a,b[3]=g*a,b}function L(a,b,c){let d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a}let M=i,_=j,N=k;class d extends Array{constructor(a=0,b=0,c=0,d=1){return super(a,b,c,d),this.onChange=()=>{},this}get x(){return this[0]}set x(a){this[0]=a,this.onChange()}get y(){return this[1]}set y(a){this[1]=a,this.onChange()}get z(){return this[2]}set z(a){this[2]=a,this.onChange()}get w(){return this[3]}set w(a){this[3]=a,this.onChange()}identity(){var a;return(a=this)[0]=0,a[1]=0,a[2]=0,a[3]=1,this.onChange(),this}set(a,b,c,d){return a.length?this.copy(a):(_(this,a,b,c,d),this.onChange(),this)}rotateX(j){var a,b,e;let f,g,h,i,c,d;return a=this,b=this,e=j,e*=.5,f=b[0],g=b[1],h=b[2],i=b[3],c=Math.sin(e),d=Math.cos(e),a[0]=f*d+i*c,a[1]=g*d+h*c,a[2]=h*d-g*c,a[3]=i*d-f*c,this.onChange(),this}rotateY(j){var a,b,e;let f,g,h,i,c,d;return a=this,b=this,e=j,e*=.5,f=b[0],g=b[1],h=b[2],i=b[3],c=Math.sin(e),d=Math.cos(e),a[0]=f*d-h*c,a[1]=g*d+i*c,a[2]=h*d+f*c,a[3]=i*d-g*c,this.onChange(),this}rotateZ(j){var a,b,e;let f,g,h,i,c,d;return a=this,b=this,e=j,e*=.5,f=b[0],g=b[1],h=b[2],i=b[3],c=Math.sin(e),d=Math.cos(e),a[0]=f*d+g*c,a[1]=g*d-f*c,a[2]=h*d+i*c,a[3]=i*d-h*c,this.onChange(),this}inverse(i=this){var a,c;let d,e,f,g,h,b;return a=this,d=(c=i)[0],e=c[1],f=c[2],g=c[3],h=d*d+e*e+f*f+g*g,b=h?1/h:0,a[0]=-d*b,a[1]=-e*b,a[2]=-f*b,a[3]=g*b,this.onChange(),this}conjugate(c=this){var b,a;return a=c,(b=this)[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=a[3],this.onChange(),this}copy(a){return M(this,a),this.onChange(),this}normalize(a=this){return N(this,a),this.onChange(),this}multiply(a,b){return b?L(this,a,b):L(this,this,a),this.onChange(),this}dot(c){var a,b;return a=this,b=c,a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}fromMatrix3(a){return function(d,a){let b,g=a[0]+a[4]+a[8];if(g>0)b=Math.sqrt(g+1),d[3]=.5*b,b=.5/b,d[0]=(a[5]-a[7])*b,d[1]=(a[6]-a[2])*b,d[2]=(a[1]-a[3])*b;else{let c=0;a[4]>a[0]&&(c=1),a[8]>a[3*c+c]&&(c=2);let e=(c+1)%3,f=(c+2)%3;b=Math.sqrt(a[3*c+c]-a[3*e+e]-a[3*f+f]+1),d[c]=.5*b,b=.5/b,d[3]=(a[3*e+f]-a[3*f+e])*b,d[e]=(a[3*e+c]+a[3*c+e])*b,d[f]=(a[3*f+c]+a[3*c+f])*b}}(this,a),this.onChange(),this}fromEuler(a){return function(a,h,i="YXZ"){let b=Math.sin(.5*h[0]),c=Math.cos(.5*h[0]),d=Math.sin(.5*h[1]),e=Math.cos(.5*h[1]),f=Math.sin(.5*h[2]),g=Math.cos(.5*h[2]);"XYZ"===i?(a[0]=b*e*g+c*d*f,a[1]=c*d*g-b*e*f,a[2]=c*e*f+b*d*g,a[3]=c*e*g-b*d*f):"YXZ"===i?(a[0]=b*e*g+c*d*f,a[1]=c*d*g-b*e*f,a[2]=c*e*f-b*d*g,a[3]=c*e*g+b*d*f):"ZXY"===i?(a[0]=b*e*g-c*d*f,a[1]=c*d*g+b*e*f,a[2]=c*e*f+b*d*g,a[3]=c*e*g-b*d*f):"ZYX"===i?(a[0]=b*e*g-c*d*f,a[1]=c*d*g+b*e*f,a[2]=c*e*f-b*d*g,a[3]=c*e*g+b*d*f):"YZX"===i?(a[0]=b*e*g+c*d*f,a[1]=c*d*g+b*e*f,a[2]=c*e*f-b*d*g,a[3]=c*e*g-b*d*f):"XZY"===i&&(a[0]=b*e*g-c*d*f,a[1]=c*d*g-b*e*f,a[2]=c*e*f+b*d*g,a[3]=c*e*g+b*d*f)}(this,a,a.order),this}fromAxisAngle(e,f){var a,b,d;let c;return a=this,b=e,d=f,c=Math.sin(d*=.5),a[0]=c*b[0],a[1]=c*b[1],a[2]=c*b[2],a[3]=Math.cos(d),this}slerp(r,s){var c,d,e,f;let l,g,m,a,b,n,o,p,q,h,i,j,k;return c=this,d=this,e=r,f=s,n=d[0],o=d[1],p=d[2],q=d[3],h=e[0],i=e[1],j=e[2],k=e[3],(g=n*h+o*i+p*j+q*k)<0&&(g=-g,h=-h,i=-i,j=-j,k=-k),1-g>1e-6?(l=Math.acos(g),m=Math.sin(l),a=Math.sin((1-f)*l)/m,b=Math.sin(f*l)/m):(a=1-f,b=f),c[0]=a*n+b*h,c[1]=a*o+b*i,c[2]=a*p+b*j,c[3]=a*q+b*k,this}fromArray(a,b=0){return this[0]=a[b],this[1]=a[b+1],this[2]=a[b+2],this[3]=a[b+3],this}toArray(a=[],b=0){return a[b]=this[0],a[b+1]=this[1],a[b+2]=this[2],a[b+3]=this[3],a}}function O(e,f,g){let h=f[0],i=f[1],j=f[2],k=f[3],l=f[4],m=f[5],n=f[6],o=f[7],p=f[8],q=f[9],r=f[10],s=f[11],t=f[12],u=f[13],v=f[14],w=f[15],a=g[0],b=g[1],c=g[2],d=g[3];return e[0]=a*h+b*l+c*p+d*t,e[1]=a*i+b*m+c*q+d*u,e[2]=a*j+b*n+c*r+d*v,e[3]=a*k+b*o+c*s+d*w,a=g[4],b=g[5],c=g[6],d=g[7],e[4]=a*h+b*l+c*p+d*t,e[5]=a*i+b*m+c*q+d*u,e[6]=a*j+b*n+c*r+d*v,e[7]=a*k+b*o+c*s+d*w,a=g[8],b=g[9],c=g[10],d=g[11],e[8]=a*h+b*l+c*p+d*t,e[9]=a*i+b*m+c*q+d*u,e[10]=a*j+b*n+c*r+d*v,e[11]=a*k+b*o+c*s+d*w,a=g[12],b=g[13],c=g[14],d=g[15],e[12]=a*h+b*l+c*p+d*t,e[13]=a*i+b*m+c*q+d*u,e[14]=a*j+b*n+c*r+d*v,e[15]=a*k+b*o+c*s+d*w,e}class c extends Array{constructor(a=1,b=0,c=0,d=0,e=0,f=1,g=0,h=0,i=0,j=0,k=1,l=0,m=0,n=0,o=0,p=1){return super(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p),this}set x(a){this[12]=a}get x(){return this[12]}set y(a){this[13]=a}get y(){return this[13]}set z(a){this[14]=a}get z(){return this[14]}set w(a){this[15]=a}get w(){return this[15]}set(b,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;return b.length?this.copy(b):(a=this,c=b,d=s,e=t,f=u,g=v,h=w,i=x,j=y,k=z,l=A,m=B,n=C,o=D,p=E,q=F,r=G,a[0]=c,a[1]=d,a[2]=e,a[3]=f,a[4]=g,a[5]=h,a[6]=i,a[7]=j,a[8]=k,a[9]=l,a[10]=m,a[11]=n,a[12]=o,a[13]=p,a[14]=q,a[15]=r,this)}translate(s,t=this){var b,a,f;let g,h,i,j,k,l,m,n,o,p,q,r,c,d,e;return b=this,a=t,c=(f=s)[0],d=f[1],e=f[2],a===b?(b[12]=a[0]*c+a[4]*d+a[8]*e+a[12],b[13]=a[1]*c+a[5]*d+a[9]*e+a[13],b[14]=a[2]*c+a[6]*d+a[10]*e+a[14],b[15]=a[3]*c+a[7]*d+a[11]*e+a[15]):(g=a[0],h=a[1],i=a[2],j=a[3],k=a[4],l=a[5],m=a[6],n=a[7],o=a[8],p=a[9],q=a[10],r=a[11],b[0]=g,b[1]=h,b[2]=i,b[3]=j,b[4]=k,b[5]=l,b[6]=m,b[7]=n,b[8]=o,b[9]=p,b[10]=q,b[11]=r,b[12]=g*c+k*d+o*e+a[12],b[13]=h*c+l*d+p*e+a[13],b[14]=i*c+m*d+q*e+a[14],b[15]=j*c+n*d+r*e+a[15]),this}rotateX(n,o=this){var a,b,m;let c,d,e,f,g,h,i,j,k,l;return a=this,b=o,c=Math.sin(m=n),d=Math.cos(m),e=b[4],f=b[5],g=b[6],h=b[7],i=b[8],j=b[9],k=b[10],l=b[11],b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=e*d+i*c,a[5]=f*d+j*c,a[6]=g*d+k*c,a[7]=h*d+l*c,a[8]=i*d-e*c,a[9]=j*d-f*c,a[10]=k*d-g*c,a[11]=l*d-h*c,this}rotateY(n,o=this){var a,b,m;let c,d,e,f,g,h,i,j,k,l;return a=this,b=o,c=Math.sin(m=n),d=Math.cos(m),e=b[0],f=b[1],g=b[2],h=b[3],i=b[8],j=b[9],k=b[10],l=b[11],b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=e*d-i*c,a[1]=f*d-j*c,a[2]=g*d-k*c,a[3]=h*d-l*c,a[8]=e*c+i*d,a[9]=f*c+j*d,a[10]=g*c+k*d,a[11]=h*c+l*d,this}rotateZ(n,o=this){var a,b,m;let c,d,e,f,g,h,i,j,k,l;return a=this,b=o,c=Math.sin(m=n),d=Math.cos(m),e=b[0],f=b[1],g=b[2],h=b[3],i=b[4],j=b[5],k=b[6],l=b[7],b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=e*d+i*c,a[1]=f*d+j*c,a[2]=g*d+k*c,a[3]=h*d+l*c,a[4]=i*d-e*c,a[5]=j*d-f*c,a[6]=k*d-g*c,a[7]=l*d-h*c,this}scale(c,h=this){var a,b,g;let d,e,f;return a=this,b=h,d=(g="number"==typeof c?[c,c,c]:c)[0],e=g[1],f=g[2],a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],this}multiply(a,b){return b?O(this,a,b):O(this,this,a),this}identity(){var a;return(a=this)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}copy(c){var b,a;return a=c,(b=this)[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],this}fromPerspective({fov:h,aspect:i,near:j,far:k}={}){var a,f,g,b,c;let d,e;return a=this,f=h,g=i,b=j,c=k,d=1/Math.tan(f/2),e=1/(b-c),a[0]=d/g,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(c+b)*e,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*c*b*e,a[15]=0,this}fromOrthogonal({left:k,right:l,bottom:m,top:n,near:o,far:p}){var a,b,c,d,e,f,g;let h,i,j;return a=this,b=k,c=l,d=m,e=n,f=o,g=p,h=1/(b-c),i=1/(d-e),j=1/(f-g),a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,this}fromQuaternion(s){var a,e;let f,c,b,g,d,h,i,j,k,l,m,n,o,p,q,r;return a=this,f=(e=s)[0],c=e[1],b=e[2],g=e[3],d=f+f,h=c+c,i=b+b,j=f*d,k=c*d,l=c*h,m=b*d,n=b*h,o=b*i,p=g*d,q=g*h,r=g*i,a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}setPosition(a){return this.x=a[0],this.y=a[1],this.z=a[2],this}inverse(E=this){var b,c;let d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,_,C,D,a;return b=this,d=(c=E)[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15],t=d*i-e*h,u=d*j-f*h,v=d*k-g*h,w=e*j-f*i,x=e*k-g*i,y=f*k-g*j,z=l*q-m*p,A=l*r-n*p,B=l*s-o*p,_=m*r-n*q,C=m*s-o*q,D=n*s-o*r,a=t*D-u*C+v*_+w*B-x*A+y*z,a&&(a=1/a,b[0]=(i*D-j*C+k*_)*a,b[1]=(f*C-e*D-g*_)*a,b[2]=(q*y-r*x+s*w)*a,b[3]=(n*x-m*y-o*w)*a,b[4]=(j*B-h*D-k*A)*a,b[5]=(d*D-f*B+g*A)*a,b[6]=(r*v-p*y-s*u)*a,b[7]=(l*y-n*v+o*u)*a,b[8]=(h*C-i*B+k*z)*a,b[9]=(e*B-d*C-g*z)*a,b[10]=(p*x-q*v+s*t)*a,b[11]=(m*v-l*x-o*t)*a,b[12]=(i*A-h*_-j*z)*a,b[13]=(d*_-e*A+f*z)*a,b[14]=(q*u-p*w-r*t)*a,b[15]=(l*w-m*u+n*t)*a),this}compose(x,y,z){var a,c,f,g;let b,d,h,i,n,j,e,o,p,q,r,s,t,u,v,w,k,l,m;return a=this,c=x,f=y,g=z,b=c[0],d=c[1],h=c[2],i=c[3],n=b+b,j=d+d,e=h+h,o=b*n,p=b*j,q=b*e,r=d*j,s=d*e,t=h*e,u=i*n,v=i*j,w=i*e,k=g[0],l=g[1],m=g[2],a[0]=(1-(r+t))*k,a[1]=(p+w)*k,a[2]=(q-v)*k,a[3]=0,a[4]=(p-w)*l,a[5]=(1-(o+t))*l,a[6]=(s+u)*l,a[7]=0,a[8]=(q+v)*m,a[9]=(s-u)*m,a[10]=(1-(o+r))*m,a[11]=0,a[12]=f[0],a[13]=f[1],a[14]=f[2],a[15]=1,this}getRotation(e){var c,a;let d,b;return c=e,a=this,d=a[0]+a[5]+a[10],b=0,d>0?(b=2*Math.sqrt(d+1),c[3]=.25*b,c[0]=(a[6]-a[9])/b,c[1]=(a[8]-a[2])/b,c[2]=(a[1]-a[4])/b):a[0]>a[5]&&a[0]>a[10]?(b=2*Math.sqrt(1+a[0]-a[5]-a[10]),c[3]=(a[6]-a[9])/b,c[0]=.25*b,c[1]=(a[1]+a[4])/b,c[2]=(a[8]+a[2])/b):a[5]>a[10]?(b=2*Math.sqrt(1+a[5]-a[0]-a[10]),c[3]=(a[8]-a[2])/b,c[0]=(a[1]+a[4])/b,c[1]=.25*b,c[2]=(a[6]+a[9])/b):(b=2*Math.sqrt(1+a[10]-a[0]-a[5]),c[3]=(a[1]-a[4])/b,c[0]=(a[8]+a[2])/b,c[1]=(a[6]+a[9])/b,c[2]=.25*b),this}getTranslation(c){var b,a;return a=this,(b=c)[0]=a[12],b[1]=a[13],b[2]=a[14],this}getScaling(l){var b,a;let c,d,e,f,g,h,i,j,k;return b=l,a=this,c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=a[8],j=a[9],k=a[10],b[0]=Math.sqrt(c*c+d*d+e*e),b[1]=Math.sqrt(f*f+g*g+h*h),b[2]=Math.sqrt(i*i+j*j+k*k),this}getMaxScaleOnAxis(){var a;let b,c,d,e,f,g,h,i,j;return a=this,b=a[0],c=a[1],d=a[2],e=a[4],f=a[5],g=a[6],h=a[8],i=a[9],j=a[10],Math.sqrt(Math.max(b*b+c*c+d*d,e*e+f*f+g*g,h*h+i*i+j*j))}lookAt(r,s,t){var a,i,j,k;let l,m,n,o,p,q,c,d,e,b,f,g,h;return a=this,i=r,j=s,k=t,l=i[0],m=i[1],n=i[2],o=k[0],p=k[1],q=k[2],c=l-j[0],d=m-j[1],e=n-j[2],b=c*c+d*d+e*e,b>0&&(c*=b=1/Math.sqrt(b),d*=b,e*=b),f=p*e-q*d,g=q*c-o*e,h=o*d-p*c,(b=f*f+g*g+h*h)>0&&(f*=b=1/Math.sqrt(b),g*=b,h*=b),a[0]=f,a[1]=g,a[2]=h,a[3]=0,a[4]=d*h-e*g,a[5]=e*f-c*h,a[6]=c*g-d*f,a[7]=0,a[8]=c,a[9]=d,a[10]=e,a[11]=0,a[12]=l,a[13]=m,a[14]=n,a[15]=1,this}determinant(){var a;let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return a=this,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],(b*g-c*f)*(l*q-m*p)-(b*h-d*f)*(k*q-m*o)+(b*i-e*f)*(k*p-l*o)+(c*h-d*g)*(j*q-m*n)-(c*i-e*g)*(j*p-l*n)+(d*i-e*h)*(j*o-k*n)}}let P=new c;class l extends Array{constructor(a=0,b=a,c=a,d="YXZ"){return super(a,b,c),this.order=d,this.onChange=()=>{},this}get x(){return this[0]}set x(a){this[0]=a,this.onChange()}get y(){return this[1]}set y(a){this[1]=a,this.onChange()}get z(){return this[2]}set z(a){this[2]=a,this.onChange()}set(a,b=a,c=a){return a.length?this.copy(a):(this[0]=a,this[1]=b,this[2]=c,this.onChange(),this)}copy(a){return this[0]=a[0],this[1]=a[1],this[2]=a[2],this}reorder(a){return this.order=a,this.onChange(),this}fromRotationMatrix(a,b=this.order){return function(b,a,c="YXZ"){"XYZ"===c?(b[1]=Math.asin(Math.min(Math.max(a[8],-1),1)),.99999>Math.abs(a[8])?(b[0]=Math.atan2(-a[9],a[10]),b[2]=Math.atan2(-a[4],a[0])):(b[0]=Math.atan2(a[6],a[5]),b[2]=0)):"YXZ"===c?(b[0]=Math.asin(-Math.min(Math.max(a[9],-1),1)),.99999>Math.abs(a[9])?(b[1]=Math.atan2(a[8],a[10]),b[2]=Math.atan2(a[1],a[5])):(b[1]=Math.atan2(-a[2],a[0]),b[2]=0)):"ZXY"===c?(b[0]=Math.asin(Math.min(Math.max(a[6],-1),1)),.99999>Math.abs(a[6])?(b[1]=Math.atan2(-a[2],a[10]),b[2]=Math.atan2(-a[4],a[5])):(b[1]=0,b[2]=Math.atan2(a[1],a[0]))):"ZYX"===c?(b[1]=Math.asin(-Math.min(Math.max(a[2],-1),1)),.99999>Math.abs(a[2])?(b[0]=Math.atan2(a[6],a[10]),b[2]=Math.atan2(a[1],a[0])):(b[0]=0,b[2]=Math.atan2(-a[4],a[5]))):"YZX"===c?(b[2]=Math.asin(Math.min(Math.max(a[1],-1),1)),.99999>Math.abs(a[1])?(b[0]=Math.atan2(-a[9],a[5]),b[1]=Math.atan2(-a[2],a[0])):(b[0]=0,b[1]=Math.atan2(a[8],a[10]))):"XZY"===c&&(b[2]=Math.asin(-Math.min(Math.max(a[4],-1),1)),.99999>Math.abs(a[4])?(b[0]=Math.atan2(a[6],a[5]),b[1]=Math.atan2(a[8],a[0])):(b[0]=Math.atan2(-a[9],a[10]),b[1]=0))}(this,a,b),this}fromQuaternion(a,b=this.order){return P.fromQuaternion(a),this.fromRotationMatrix(P,b)}}class g{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new c,this.worldMatrix=new c,this.matrixAutoUpdate=!0,this.position=new b,this.quaternion=new d,this.scale=new b(1),this.rotation=new l,this.up=new b(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(a,b=!0){b&&this.parent&&a!==this.parent&&this.parent.removeChild(this,!1),this.parent=a,b&&a&&a.addChild(this,!1)}addChild(a,b=!0){~this.children.indexOf(a)||this.children.push(a),b&&a.setParent(this,!1)}removeChild(a,b=!0){~this.children.indexOf(a)&&this.children.splice(this.children.indexOf(a),1),b&&a.setParent(null,!1)}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||a)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,a=!0);for(let b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(b){if(!b(this))for(let a=0,c=this.children.length;a<c;a++)this.children[a].traverse(b)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(a,b=!1){b?this.matrix.lookAt(this.position,a,this.up):this.matrix.lookAt(a,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}let Q=new c,R=new b,S=new b;function T(a,b,c){let d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a}class m extends Array{constructor(a=1,b=0,c=0,d=0,e=1,f=0,g=0,h=0,i=1){return super(a,b,c,d,e,f,g,h,i),this}set(b,l,m,n,o,p,q,r,s){var a,c,d,e,f,g,h,i,j,k;return b.length?this.copy(b):(a=this,c=b,d=l,e=m,f=n,g=o,h=p,i=q,j=r,k=s,a[0]=c,a[1]=d,a[2]=e,a[3]=f,a[4]=g,a[5]=h,a[6]=i,a[7]=j,a[8]=k,this)}translate(o,p=this){var a,b,e;let f,g,h,i,j,k,l,m,n,c,d;return a=this,b=p,e=o,f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7],n=b[8],c=e[0],d=e[1],a[0]=f,a[1]=g,a[2]=h,a[3]=i,a[4]=j,a[5]=k,a[6]=c*f+d*i+l,a[7]=c*g+d*j+m,a[8]=c*h+d*k+n,this}rotate(o,p=this){var a,b,e;let f,g,h,i,j,k,l,m,n,c,d;return a=this,b=p,e=o,f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7],n=b[8],c=Math.sin(e),d=Math.cos(e),a[0]=d*f+c*i,a[1]=d*g+c*j,a[2]=d*h+c*k,a[3]=d*i-c*f,a[4]=d*j-c*g,a[5]=d*k-c*h,a[6]=l,a[7]=m,a[8]=n,this}scale(f,g=this){var a,b,e;let c,d;return a=this,b=g,c=(e=f)[0],d=e[1],a[0]=c*b[0],a[1]=c*b[1],a[2]=c*b[2],a[3]=d*b[3],a[4]=d*b[4],a[5]=d*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],this}multiply(a,b){return b?T(this,a,b):T(this,this,a),this}identity(){var a;return(a=this)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,this}copy(c){var b,a;return a=c,(b=this)[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],this}fromMatrix4(c){var b,a;return a=c,(b=this)[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[4],b[4]=a[5],b[5]=a[6],b[6]=a[8],b[7]=a[9],b[8]=a[10],this}fromQuaternion(s){var a,e;let f,c,b,g,d,h,i,j,k,l,m,n,o,p,q,r;return a=this,f=(e=s)[0],c=e[1],b=e[2],g=e[3],d=f+f,h=c+c,i=b+b,j=f*d,k=c*d,l=c*h,m=b*d,n=b*h,o=b*i,p=g*d,q=g*h,r=g*i,a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,this}fromBasis(a,b,c){return this.set(a[0],a[1],a[2],b[0],b[1],b[2],c[0],c[1],c[2]),this}inverse(p=this){var b,c;let d,e,f,g,h,i,j,k,l,m,n,o,a;return b=this,d=(c=p)[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=l*h-i*k,n=-l*g+i*j,o=k*g-h*j,a=d*m+e*n+f*o,a&&(a=1/a,b[0]=m*a,b[1]=(-l*e+f*k)*a,b[2]=(i*e-f*h)*a,b[3]=n*a,b[4]=(l*d-f*j)*a,b[5]=(-i*d+f*g)*a,b[6]=o*a,b[7]=(-k*d+e*j)*a,b[8]=(h*d-e*g)*a),this}getNormalMatrix(E){var c,a;let g,h,i,d,j,k,l,e,s,t,u,v,m,n,o,f,B,C,w,D,x,y,z,A,p,_,q,r,b;return c=this,g=(a=E)[0],h=a[1],i=a[2],d=a[3],j=a[4],k=a[5],l=a[6],e=a[7],s=a[8],t=a[9],u=a[10],v=a[11],m=a[12],n=a[13],o=a[14],f=a[15],B=g*k-h*j,C=g*l-i*j,w=g*e-d*j,D=h*l-i*k,x=h*e-d*k,y=i*e-d*l,z=s*n-t*m,A=s*o-u*m,p=s*f-v*m,_=t*o-u*n,q=t*f-v*n,r=u*f-v*o,b=B*r-C*q+w*_+D*p-x*A+y*z,b&&(b=1/b,c[0]=(k*r-l*q+e*_)*b,c[1]=(l*p-j*r-e*A)*b,c[2]=(j*q-k*p+e*z)*b,c[3]=(i*q-h*r-d*_)*b,c[4]=(g*r-i*p+d*A)*b,c[5]=(h*p-g*q-d*z)*b,c[6]=(n*y-o*x+f*D)*b,c[7]=(o*w-m*y-f*C)*b,c[8]=(m*x-n*w+f*B)*b),this}}let U=0;class n extends g{constructor(a,{geometry:b,program:d,mode:e=a.TRIANGLES,frustumCulled:f=!0,renderOrder:g=0}={}){super(a),this.gl=a,this.id=U++,this.geometry=b,this.program=d,this.mode=e,this.frustumCulled=f,this.renderOrder=g,this.modelViewMatrix=new c,this.normalMatrix=new m,this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}})}draw({camera:a}={}){this.onBeforeRender&&this.onBeforeRender({mesh:this,camera:a}),a&&(this.program.uniforms.projectionMatrix.value=a.projectionMatrix,this.program.uniforms.cameraPosition.value=a.position,this.program.uniforms.viewMatrix.value=a.viewMatrix,this.modelViewMatrix.multiply(a.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let b=this.program.cullFace&&0>this.worldMatrix.determinant();this.program.use({flipFaces:b}),this.geometry.draw({mode:this.mode,program:this.program}),this.onAfterRender&&this.onAfterRender({mesh:this,camera:a})}}let V=new Uint8Array(4);function W(a){return 0==(a&a-1)}let X=0;class o{constructor(a,{image:e,target:f=a.TEXTURE_2D,type:g=a.UNSIGNED_BYTE,format:b=a.RGBA,internalFormat:h=b,wrapS:i=a.CLAMP_TO_EDGE,wrapT:j=a.CLAMP_TO_EDGE,generateMipmaps:c=!0,minFilter:k=c?a.NEAREST_MIPMAP_LINEAR:a.LINEAR,magFilter:l=a.LINEAR,premultiplyAlpha:m=!1,unpackAlignment:n=4,flipY:o=!0,level:p=0,width:d,height:q=d}={}){this.gl=a,this.id=X++,this.image=e,this.target=f,this.type=g,this.format=b,this.internalFormat=h,this.minFilter=k,this.magFilter=l,this.wrapS=i,this.wrapT=j,this.generateMipmaps=c,this.premultiplyAlpha=m,this.unpackAlignment=n,this.flipY=o,this.level=p,this.width=d,this.height=q,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(a=0){let b=!(this.image===this.store.image&&!this.needsUpdate);(b||this.glState.textureUnits[a]!==this.id)&&(this.gl.renderer.activeTexture(a),this.bind()),b&&(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.image?(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.gl.renderer.isWebgl2||ArrayBuffer.isView(this.image)?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image):this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image),this.generateMipmaps&&(this.gl.renderer.isWebgl2||W(this.image.width)&&W(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR))):this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,V),this.store.image=this.image,this.onUpdate&&this.onUpdate())}}class p{constructor(a,{width:b=a.canvas.width,height:c=a.canvas.height,target:k=a.FRAMEBUFFER,color:l=1,depth:e=!0,stencil:f=!1,depthTexture:m=!1,wrapS:g=a.CLAMP_TO_EDGE,wrapT:h=a.CLAMP_TO_EDGE,minFilter:i=a.LINEAR,magFilter:n=i,type:p=a.UNSIGNED_BYTE,format:j=a.RGBA,internalFormat:q=j,unpackAlignment:r,premultiplyAlpha:s}={}){this.gl=a,this.width=b,this.height=c,this.buffer=this.gl.createFramebuffer(),this.target=k,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];for(let d=0;d<l;d++)this.textures.push(new o(a,{width:b,height:c,wrapS:g,wrapT:h,minFilter:i,magFilter:n,type:p,format:j,internalFormat:q,unpackAlignment:r,premultiplyAlpha:s,flipY:!1,generateMipmaps:!1})),this.textures[d].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+d,this.gl.TEXTURE_2D,this.textures[d].texture,0);this.texture=this.textures[0],m&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new o(a,{width:b,height:c,wrapS:g,wrapT:h,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,flipY:!1,format:this.gl.DEPTH_COMPONENT,internalFormat:a.renderer.isWebgl2?this.gl.DEPTH_COMPONENT24:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT,generateMipmaps:!1}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(e&&!f&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,b,c),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),f&&!e&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,b,c),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),e&&f&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,b,c),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.bindFramebuffer(this.target,null)}}class q extends Array{constructor(a=0,b=0,c=0){return"string"==typeof a&&([a,b,c]=q.hexToRGB(a)),super(a,b,c),this}get r(){return this[0]}set r(a){this[0]=a}get g(){return this[1]}set g(a){this[1]=a}get b(){return this[2]}set b(a){this[2]=a}set(a,b,c){return"string"==typeof a&&([a,b,c]=q.hexToRGB(a)),a.length?this.copy(a):(this[0]=a,this[1]=b,this[2]=c,this)}copy(a){return this[0]=a[0],this[1]=a[1],this[2]=a[2],this}static hexToRGB(a){4===a.length&&(a=a[0]+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]);let b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b||console.warn(`Unable to convert hex string ${a} to rgb values`),[parseInt(b[1],16)/255,parseInt(b[2],16)/255,parseInt(b[3],16)/255]}}function Y(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a}function $(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a}function Z(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a}function aa(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)}class e extends Array{constructor(a=0,b=a){return super(a,b),this}get x(){return this[0]}set x(a){this[0]=a}get y(){return this[1]}set y(a){this[1]=a}set(a,e=a){var b,c,d;return a.length?this.copy(a):(b=this,c=a,d=e,b[0]=c,b[1]=d,this)}copy(c){var b,a;return a=c,(b=this)[0]=a[0],b[1]=a[1],this}add(a,b){return b?Y(this,a,b):Y(this,this,a),this}sub(a,b){return b?$(this,a,b):$(this,this,a),this}multiply(a){var d,b,c;return a.length?(b=this,c=a,(d=this)[0]=b[0]*c[0],d[1]=b[1]*c[1]):Z(this,this,a),this}divide(a){var d,b,c;return a.length?(b=this,c=a,(d=this)[0]=b[0]/c[0],d[1]=b[1]/c[1]):Z(this,this,1/a),this}inverse(c=this){var b,a;return a=c,(b=this)[0]=1/a[0],b[1]=1/a[1],this}len(){return aa(this)}distance(d){var a,e,b,c;return d?(a=this,b=(e=d)[0]-a[0],c=e[1]-a[1],Math.sqrt(b*b+c*c)):aa(this)}squaredLen(){return this.squaredDistance()}squaredDistance(g){var a,h,b,c,d,e,f;return g?(a=this,b=(h=g)[0]-a[0],c=h[1]-a[1],b*b+c*c):(d=this,e=d[0],f=d[1],e*e+f*f)}negate(c=this){var b,a;return a=c,(b=this)[0]=-a[0],b[1]=-a[1],this}cross(c,d){var b,a;return a=d,(b=c)[0]*a[1]-b[1]*a[0]}scale(a){return Z(this,this,a),this}normalize(){var c,b,d,e,a;return c=this,d=(b=this)[0],e=b[1],(a=d*d+e*e)>0&&(a=1/Math.sqrt(a)),c[0]=b[0]*a,c[1]=b[1]*a,this}dot(c){var b,a;return a=c,(b=this)[0]*a[0]+b[1]*a[1]}equals(c){var b,a;return a=c,(b=this)[0]===a[0]&&b[1]===a[1]}applyMatrix3(f){var b,e,a,c,d;return b=this,a=f,c=(e=this)[0],d=e[1],b[0]=a[0]*c+a[3]*d+a[6],b[1]=a[1]*c+a[4]*d+a[7],this}applyMatrix4(f){var b,c,a;let d,e;return b=this,c=this,a=f,d=c[0],e=c[1],b[0]=a[0]*d+a[4]*e+a[12],b[1]=a[1]*d+a[5]*e+a[13],this}lerp(g,h){var a,b,c,d,e,f;a=this,b=this,c=g,d=h,e=b[0],f=b[1],a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f)}clone(){return new e(this[0],this[1])}fromArray(a,b=0){return this[0]=a[b],this[1]=a[b+1],this}toArray(a=[],b=0){return a[b]=this[0],a[b+1]=this[1],a}}class r extends f{constructor(j,{width:k=1,height:l=1,widthSegments:m=1,heightSegments:n=1,attributes:d={}}={}){let b=m,c=n,a=(b+1)*(c+1),e=b*c*6,f=new Float32Array(3*a),g=new Float32Array(3*a),h=new Float32Array(2*a),i=a>65536?new Uint32Array(e):new Uint16Array(e);r.buildPlane(f,g,h,i,k,l,0,b,c),Object.assign(d,{position:{size:3,data:f},normal:{size:3,data:g},uv:{size:2,data:h},index:{data:i}}),super(j,d)}static buildPlane(i,j,k,f,l,m,n,d,g,o=0,p=1,q=2,t=1,u=-1,a=0,e=0){let h=a,v=l/d,w=m/g;for(let b=0;b<=g;b++){let x=b*w-m/2;for(let c=0;c<=d;c++,a++){let y=c*v-l/2;if(i[3*a+o]=y*t,i[3*a+p]=x*u,i[3*a+q]=n/2,j[3*a+o]=0,j[3*a+p]=0,j[3*a+q]=n>=0?1:-1,k[2*a]=c/d,k[2*a+1]=1-b/g,b===g||c===d)continue;let z=h+c+b*(d+1),r=h+c+(b+1)*(d+1),A=h+c+(b+1)*(d+1)+1,s=h+c+b*(d+1)+1;f[6*e]=z,f[6*e+1]=r,f[6*e+2]=s,f[6*e+3]=r,f[6*e+4]=A,f[6*e+5]=s,e++}}}}let ab={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,DOLLY_PAN:3},ac=new b,ad=new e,ae=new e,af=new b,ag=new b,ah=new b,ai=new c,aj=new b,ak=new d,al=new b,am=new b,an=new d,ao=new b;class s{constructor({objects:b,data:a}){this.objects=b,this.data=a,this.elapsed=0,this.weight=1,this.duration=a.frames.length-1}update(c=1,d){let e=d?1:this.weight/c,b=this.elapsed%this.duration,a=Math.floor(b),f=b-a,g=this.data.frames[a],h=this.data.frames[(a+1)%this.duration];this.objects.forEach((b,a)=>{aj.fromArray(g.position,3*a),ak.fromArray(g.quaternion,4*a),al.fromArray(g.scale,3*a),am.fromArray(h.position,3*a),an.fromArray(h.quaternion,4*a),ao.fromArray(h.scale,3*a),aj.lerp(am,f),ak.slerp(an,f),al.lerp(ao,f),b.position.lerp(aj,e),b.quaternion.slerp(ak,e),b.scale.lerp(al,e)})}}let ap=new c;return a.Animation=s,a.Box=class extends f{constructor(p,{width:h=1,height:i=1,depth:j=1,widthSegments:q=1,heightSegments:s=1,depthSegments:t=1,attributes:n={}}={}){let c=q,a=s,b=t,m=(c+1)*(a+1)*2+(c+1)*(b+1)*2+(a+1)*(b+1)*2,o=6*(c*a*2+c*b*2+a*b*2),d=new Float32Array(3*m),e=new Float32Array(3*m),f=new Float32Array(2*m),g=m>65536?new Uint32Array(o):new Uint16Array(o),k=0,l=0;r.buildPlane(d,e,f,g,j,i,h,b,a,2,1,0,-1,-1,k,l),r.buildPlane(d,e,f,g,j,i,-h,b,a,2,1,0,1,-1,k+=(b+1)*(a+1),l+=b*a),r.buildPlane(d,e,f,g,h,j,i,b,a,0,2,1,1,1,k+=(b+1)*(a+1),l+=b*a),r.buildPlane(d,e,f,g,h,j,-i,b,a,0,2,1,1,-1,k+=(c+1)*(b+1),l+=c*b),r.buildPlane(d,e,f,g,h,i,-j,c,a,0,1,2,-1,-1,k+=(c+1)*(b+1),l+=c*b),r.buildPlane(d,e,f,g,h,i,j,c,a,0,1,2,1,-1,k+=(c+1)*(a+1),l+=c*a),Object.assign(n,{position:{size:3,data:d},normal:{size:3,data:e},uv:{size:2,data:f},index:{data:g}}),super(p,n)}},a.Camera=class extends g{constructor(d,{near:e=.1,far:f=100,fov:g=45,aspect:h=1,left:a,right:b,bottom:i,top:j}={}){super(d),this.near=e,this.far=f,this.fov=g,this.aspect=h,this.projectionMatrix=new c,this.viewMatrix=new c,this.projectionViewMatrix=new c,a||b?this.orthographic({left:a,right:b,bottom:i,top:j}):this.perspective()}perspective({near:a=this.near,far:b=this.far,fov:c=this.fov,aspect:d=this.aspect}={}){return this.projectionMatrix.fromPerspective({fov:c*(Math.PI/180),aspect:d,near:a,far:b}),this.type="perspective",this}orthographic({near:a=this.near,far:b=this.far,left:c=-1,right:d=1,bottom:e=-1,top:f=1}={}){return this.projectionMatrix.fromOrthogonal({left:c,right:d,bottom:e,top:f,near:a,far:b}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(a){return super.lookAt(a,!0),this}project(a){return a.applyMatrix4(this.viewMatrix),a.applyMatrix4(this.projectionMatrix),this}unproject(a){return a.applyMatrix4(Q.inverse(this.projectionMatrix)),a.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new b,new b,new b,new b,new b,new b]);let a=this.projectionViewMatrix;this.frustum[0].set(a[3]-a[0],a[7]-a[4],a[11]-a[8]).constant=a[15]-a[12],this.frustum[1].set(a[3]+a[0],a[7]+a[4],a[11]+a[8]).constant=a[15]+a[12],this.frustum[2].set(a[3]+a[1],a[7]+a[5],a[11]+a[9]).constant=a[15]+a[13],this.frustum[3].set(a[3]-a[1],a[7]-a[5],a[11]-a[9]).constant=a[15]-a[13],this.frustum[4].set(a[3]-a[2],a[7]-a[6],a[11]-a[10]).constant=a[15]-a[14],this.frustum[5].set(a[3]+a[2],a[7]+a[6],a[11]+a[10]).constant=a[15]+a[14];for(let c=0;c<6;c++){let d=1/this.frustum[c].distance();this.frustum[c].multiply(d),this.frustum[c].constant*=d}}frustumIntersectsMesh(a){if(!a.geometry.attributes.position)return!0;a.geometry.bounds&&a.geometry.bounds.radius!==1/0||a.geometry.computeBoundingSphere();let b=R;b.copy(a.geometry.bounds.center),b.applyMatrix4(a.worldMatrix);let c=a.geometry.bounds.radius*a.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(b,c)}frustumIntersectsSphere(c,d){let e=S;for(let a=0;a<6;a++){let b=this.frustum[a];if(e.copy(b).dot(c)+b.constant< -d)return!1}return!0}},a.Color=q,a.Cylinder=class extends f{constructor(A,{radius:w=.5,height:r=1,radialSegments:s=16,heightSegments:t=1,attributes:x={}}={}){let u=s,o=t,q=(s+1)*(t+1)+2,y=s*(2+2*t)*3,h=new Float32Array(3*q),i=new Float32Array(3*q),n=new Float32Array(2*q),d=q>65536?new Uint32Array(y):new Uint16Array(y),k,l,m,a=0,e=new b;k=0,l=-0.5*r,m=0,h[3*a+0]=k,h[3*a+1]=l,h[3*a+2]=m,e.set(k,l,m).normalize(),i[3*a]=e.x,i[3*a+1]=e.y,i[3*a+2]=e.z,n[2*a]=0,n[2*a+1]=1;let B=a;k=0,l=.5*r,m=0,h[3* ++a+0]=k,h[3*a+1]=l,h[3*a+2]=m,e.set(k,l,m).normalize(),i[3*a]=e.x,i[3*a+1]=e.y,i[3*a+2]=e.z,n[2*a]=0,n[2*a+1]=0;let C=a;a++;for(var f=0;f<u+1;f++){let v=f/u;for(var g=0;g<o+1;g++){let z=g/o;k=Math.cos(v*Math.PI*2)*w,l=(z-.5)*r,m=Math.sin(v*Math.PI*2)*w,h[3*a+0]=k,h[3*a+1]=l,h[3*a+2]=m,e.set(k,l,m).normalize(),i[3*a]=e.x,i[3*a+1]=e.y,i[3*a+2]=e.z,n[2*a]=v,n[2*a+1]=1-z,a++}}let c=0,j=o+1;for(f=0;f<u;f++){let p=f+1;for(d[3*c+0]=B,d[3*c+1]=2+f*j,d[3*c+2]=2+p*j,c++,g=0;g<o;g++)d[3*c+0]=2+f*j+(g+0),d[3*c+1]=2+f*j+(g+1),d[3*c+2]=2+p*j+(g+0),d[3* ++c+0]=2+p*j+(g+0),d[3*c+1]=2+f*j+(g+1),d[3*c+2]=2+p*j+(g+1),c++;d[3*c+0]=2+p*j+o,d[3*c+1]=2+f*j+o,d[3*c+2]=C,c++}Object.assign(x,{position:{size:3,data:h},normal:{size:3,data:i},uv:{size:2,data:n},index:{data:d}}),super(A,x)}},a.Euler=l,a.Flowmap=class{constructor(a,{size:i=512,falloff:c=.3,alpha:d=1,dissipation:g=.96}={}){let b=this;this.gl=a,this.uniform={value:null},this.mask={read:null,write:null,swap(){let a=b.mask.read;b.mask.read=b.mask.write,b.mask.write=a,b.uniform.value=b.mask.read.texture}},function(){let d=a.renderer.extensions[`OES_texture_${a.renderer.isWebgl2?"":"half_"}float_linear`],c={width:i,height:i,type:a.renderer.isWebgl2?a.HALF_FLOAT:a.renderer.extensions.OES_texture_half_float?a.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:a.UNSIGNED_BYTE,format:a.RGBA,internalFormat:a.renderer.isWebgl2?a.RGBA16F:a.RGBA,minFilter:d?a.LINEAR:a.NEAREST,depth:!1};b.mask.read=new p(a,c),b.mask.write=new p(a,c),b.mask.swap()}(),this.aspect=1,this.mouse=new e,this.velocity=new e,this.mesh=new n(a,{geometry:new f(a,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),program:new h(a,{vertex:"\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",fragment:"\n    precision highp float;\n\n    uniform sampler2D tMap;\n\n    uniform float uFalloff;\n    uniform float uAlpha;\n    uniform float uDissipation;\n\n    uniform float uAspect;\n    uniform vec2 uMouse;\n    uniform vec2 uVelocity;\n\n    varying vec2 vUv;\n\n    void main() {\n\n      vec2 cursor = vUv - uMouse;\n\n        vec4 color = texture2D(tMap, vUv) * uDissipation;\n\n        cursor.x *= uAspect;\n\n        vec3 stamp = vec3(uVelocity * vec2(1, -1), 1.0 - pow(1.0 - min(1.0, length(uVelocity)), 3.0));\n        float falloff = smoothstep(uFalloff, 0.0, length(cursor)) * uAlpha;\n\n        color.rgb = mix(color.rgb, stamp, vec3(falloff));\n\n        gl_FragColor = color;\n    }\n",uniforms:{tMap:b.uniform,uFalloff:{value:.5*c},uAlpha:{value:d},uDissipation:{value:g},uAspect:{value:1},uMouse:{value:b.mouse},uVelocity:{value:b.velocity}},depthTest:!1})})}update(){this.mesh.program.uniforms.uAspect.value=this.aspect,this.gl.renderer.render({scene:this.mesh,target:this.mask.write,clear:!1}),this.mask.swap()}},a.GPGPU=class{constructor(a,{data:d=new Float32Array(16),geometry:e=new f(a,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}})}){this.gl=a;let g=d;this.passes=[],this.geometry=e,this.dataLength=g.length/4,this.size=Math.pow(2,Math.ceil(Math.log(Math.ceil(Math.sqrt(this.dataLength)))/Math.LN2)),this.coords=new Float32Array(2*this.dataLength);for(let b=0;b<this.dataLength;b++){let h=b%this.size/this.size,i=Math.floor(b/this.size)/this.size;this.coords.set([h,i],2*b)}let j=(()=>{if(g.length===this.size*this.size*4)return g;{let a=new Float32Array(this.size*this.size*4);return a.set(g),a}})();this.uniform={value:new o(a,{image:j,target:a.TEXTURE_2D,type:a.FLOAT,format:a.RGBA,internalFormat:a.renderer.isWebgl2?a.RGBA32F:a.RGBA,wrapS:a.CLAMP_TO_EDGE,wrapT:a.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:a.NEAREST,magFilter:a.NEAREST,width:this.size,flipY:!1})};let c={width:this.size,height:this.size,type:a.renderer.isWebgl2?a.HALF_FLOAT:a.renderer.extensions.OES_texture_half_float?a.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:a.UNSIGNED_BYTE,format:a.RGBA,internalFormat:a.renderer.isWebgl2?a.RGBA16F:a.RGBA,minFilter:a.NEAREST,depth:!1,unpackAlignment:1};this.fbo={read:new p(a,c),write:new p(a,c),swap:()=>{let a=this.fbo.read;this.fbo.read=this.fbo.write,this.fbo.write=a,this.uniform.value=this.fbo.read.texture}}}addPass({vertex:e="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",fragment:f="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",uniforms:a={},textureUniform:b="tMap",enabled:g=!0}={}){a[b]=this.uniform;let c=new h(this.gl,{vertex:e,fragment:f,uniforms:a}),d={mesh:new n(this.gl,{geometry:this.geometry,program:c}),program:c,uniforms:a,enabled:g,textureUniform:b};return this.passes.push(d),d}render(){this.passes.filter(a=>a.enabled).forEach((a,b)=>{this.gl.renderer.render({scene:a.mesh,target:this.fbo.write,clear:!1}),this.fbo.swap()})}},a.Geometry=f,a.Mat3=m,a.Mat4=c,a.Mesh=n,a.NormalProgram=function(a){return new h(a,{vertex:"\nprecision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat3 normalMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec3 vNormal;\n\nvoid main() {\n    vNormal = normalize(normalMatrix * normal);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragment:"\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vNormal;\n\nvoid main() {\n    gl_FragColor.rgb = normalize(vNormal);\n    gl_FragColor.a = 1.0;\n}\n"})},a.Orbit=function(i,{element:a=document,enabled:j=!0,target:k=new b,ease:g=.25,inertia:h=.85,enableRotate:t=!0,rotateSpeed:u=.1,enableZoom:v=!0,zoomSpeed:w=1,enablePan:x=!0,panSpeed:y=.1,minPolarAngle:z=0,maxPolarAngle:A=Math.PI,minAzimuthAngle:B=-1/0,maxAzimuthAngle:C=1/0,minDistance:l=0,maxDistance:m=1/0}={}){this.enabled=j,this.target=k,g=g||1,h=h||1,this.minDistance=l,this.maxDistance=m;let D={radius:1,phi:0,theta:0},d={radius:1,phi:0,theta:0},f={radius:1,phi:0,theta:0},E=new b,c=new b;c.copy(i.position).sub(this.target),f.radius=d.radius=c.distance(),f.theta=d.theta=Math.atan2(c.x,c.z),f.phi=d.phi=Math.acos(Math.min(Math.max(c.y/d.radius,-1),1)),this.update=()=>{d.radius*=D.radius,d.theta+=D.theta,d.phi+=D.phi,d.theta=Math.max(B,Math.min(C,d.theta)),d.phi=Math.max(z,Math.min(A,d.phi)),d.radius=Math.max(this.minDistance,Math.min(this.maxDistance,d.radius)),f.phi+=(d.phi-f.phi)*g,f.theta+=(d.theta-f.theta)*g,f.radius+=(d.radius-f.radius)*g,this.target.add(E);let a=f.radius*Math.sin(Math.max(1e-6,f.phi));c.x=a*Math.sin(f.theta),c.y=f.radius*Math.cos(f.phi),c.z=a*Math.cos(f.theta),i.position.copy(this.target).add(c),i.lookAt(this.target),D.theta*=h,D.phi*=h,E.multiply(h),D.radius=1};let F=new e,G=new e,H=new e,_=ab.NONE;function I(){return Math.pow(.95,w)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};let J=(h,j)=>{var d,b,e,c;let f=a===document?document.body:a;ac.copy(i.position).sub(this.target);let g=ac.distance();d=2*h*(g*=Math.tan((i.fov||45)/2*Math.PI/180))/f.clientHeight,b=i.matrix,ac.set(b[0],b[1],b[2]),ac.multiply(-d),E.add(ac),e=2*j*g/f.clientHeight,c=i.matrix,ac.set(c[4],c[5],c[6]),ac.multiply(e),E.add(ac)};function K(a){D.radius/=a}function L(c,d){ad.set(c,d),ae.sub(ad,F).multiply(u);let b=a===document?document.body:a;D.theta-=2*Math.PI*ae.x/b.clientHeight,D.phi-=2*Math.PI*ae.y/b.clientHeight,F.copy(ad)}function M(a,b){ad.set(a,b),ae.sub(ad,G).multiply(y),J(ae.x,ae.y),G.copy(ad)}let n=a=>{if(this.enabled){switch(a.button){case this.mouseButtons.ORBIT:if(!1===t)return;F.set(a.clientX,a.clientY),_=ab.ROTATE;break;case this.mouseButtons.ZOOM:if(!1===v)return;H.set(a.clientX,a.clientY),_=ab.DOLLY;break;case this.mouseButtons.PAN:if(!1===x)return;G.set(a.clientX,a.clientY),_=ab.PAN}_!==ab.NONE&&(window.addEventListener("mousemove",N,!1),window.addEventListener("mouseup",O,!1))}},N=a=>{if(this.enabled)switch(_){case ab.ROTATE:if(!1===t)return;L(a.clientX,a.clientY);break;case ab.DOLLY:var b;if(!1===v)return;b=a,ad.set(b.clientX,b.clientY),ae.sub(ad,H),ae.y>0?K(I()):ae.y<0&&K(1/I()),H.copy(ad);break;case ab.PAN:if(!1===x)return;M(a.clientX,a.clientY)}},O=()=>{this.enabled&&(document.removeEventListener("mousemove",N,!1),document.removeEventListener("mouseup",O,!1),_=ab.NONE)},o=a=>{this.enabled&&v&&(_===ab.NONE||_===ab.ROTATE)&&(a.stopPropagation(),a.deltaY<0?K(1/I()):a.deltaY>0&&K(I()))},p=a=>{if(this.enabled)switch(a.preventDefault(),a.touches.length){case 1:if(!1===t)return;F.set(a.touches[0].pageX,a.touches[0].pageY),_=ab.ROTATE;break;case 2:if(!1===v&& !1===x)return;(function(a){if(v){let b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);H.set(0,d)}if(x){let e=.5*(a.touches[0].pageX+a.touches[1].pageX),f=.5*(a.touches[0].pageY+a.touches[1].pageY);G.set(e,f)}})(a),_=ab.DOLLY_PAN;break;default:_=ab.NONE}},q=a=>{if(this.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(!1===t)return;L(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(!1===v&& !1===x)return;!function(a){if(v){let b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);ad.set(0,d),ae.set(0,Math.pow(ad.y/H.y,w)),K(ae.y),H.copy(ad)}x&&M(.5*(a.touches[0].pageX+a.touches[1].pageX),.5*(a.touches[0].pageY+a.touches[1].pageY))}(a);break;default:_=ab.NONE}},r=()=>{this.enabled&&(_=ab.NONE)},s=a=>{this.enabled&&a.preventDefault()};this.remove=function(){a.removeEventListener("contextmenu",s,!1),a.removeEventListener("mousedown",n,!1),window.removeEventListener("wheel",o,!1),a.removeEventListener("touchstart",p,!1),a.removeEventListener("touchend",r,!1),a.removeEventListener("touchmove",q,!1),window.removeEventListener("mousemove",N,!1),window.removeEventListener("mouseup",O,!1)},a.addEventListener("contextmenu",s,!1),a.addEventListener("mousedown",n,!1),window.addEventListener("wheel",o,!1),a.addEventListener("touchstart",p,{passive:!1}),a.addEventListener("touchend",r,!1),a.addEventListener("touchmove",q,{passive:!1})},a.Plane=r,a.Post=class{constructor(a,{width:b,height:c,dpr:d,wrapS:e=a.CLAMP_TO_EDGE,wrapT:g=a.CLAMP_TO_EDGE,minFilter:h=a.LINEAR,magFilter:i=a.LINEAR,geometry:j=new f(a,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}})}={}){this.gl=a,this.options={wrapS:e,wrapT:g,minFilter:h,magFilter:i},this.passes=[],this.geometry=j;let k=this.fbo={read:null,write:null,swap(){let a=k.read;k.read=k.write,k.write=a}};this.resize({width:b,height:c,dpr:d})}addPass({vertex:e="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",fragment:f="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",uniforms:a={},textureUniform:b="tMap",enabled:g=!0}={}){a[b]={value:this.fbo.read.texture};let c=new h(this.gl,{vertex:e,fragment:f,uniforms:a}),d={mesh:new n(this.gl,{geometry:this.geometry,program:c}),program:c,uniforms:a,enabled:g,textureUniform:b};return this.passes.push(d),d}resize({width:a,height:c,dpr:b}={}){b&&(this.dpr=b),a&&(this.width=a,this.height=c||a),b=this.dpr||this.gl.renderer.dpr,a=(this.width||this.gl.renderer.width)*b,c=(this.height||this.gl.renderer.height)*b,this.options.width=a,this.options.height=c,this.fbo.read=new p(this.gl,this.options),this.fbo.write=new p(this.gl,this.options)}render({scene:b,camera:c,target:d=null,update:e=!0,sort:f=!0,frustumCull:g=!0}){let a=this.passes.filter(a=>a.enabled);this.gl.renderer.render({scene:b,camera:c,target:a.length?this.fbo.write:d,update:e,sort:f,frustumCull:g}),this.fbo.swap(),a.forEach((b,c)=>{b.mesh.program.uniforms[b.textureUniform].value=this.fbo.read.texture,this.gl.renderer.render({scene:b.mesh,target:c===a.length-1?d:this.fbo.write,clear:!1}),this.fbo.swap()})}},a.Program=h,a.Quat=d,a.Raycast=class{constructor(a){this.gl=a,this.origin=new b,this.direction=new b}castMouse(a,b=[0,0]){a.worldMatrix.getTranslation(this.origin),this.direction.set(b[0],b[1],.5),a.unproject(this.direction),this.direction.sub(this.origin).normalize()}intersectBounds(a){Array.isArray(a)||(a=[a]);let d=ai,e=af,f=ag,c=[];return a.forEach(a=>{a.geometry.bounds||a.geometry.computeBoundingBox(),"sphere"===a.geometry.raycast&&a.geometry.bounds===1/0&&a.geometry.computeBoundingSphere(),d.inverse(a.worldMatrix),e.copy(this.origin).applyMatrix4(d),f.copy(this.direction).transformDirection(d);let g=0;(g="sphere"===a.geometry.raycast?this.intersectSphere(a.geometry.bounds,e,f):this.intersectBox(a.geometry.bounds,e,f))&&(a.hit||(a.hit={localPoint:new b}),a.hit.distance=g,a.hit.localPoint.copy(f).multiply(g).add(e),c.push(a))}),c.sort((a,b)=>a.hit.distance-b.hit.distance),c}intersectSphere(c,i=this.origin,j=this.direction){let a=ah;a.sub(c.center,i);let b=a.dot(j),e=a.dot(a)-b*b,f=c.radius*c.radius;if(e>f)return 0;let g=Math.sqrt(f-e),d=b-g,h=b+g;return d<0&&h<0?0:d<0?h:d}intersectBox(n,c=this.origin,k=this.direction){let a,b,f,l,g,m,h=1/k.x,i=1/k.y,j=1/k.z,d=n.min,e=n.max;return a=((h>=0?d.x:e.x)-c.x)*h,b=((h>=0?e.x:d.x)-c.x)*h,f=((i>=0?d.y:e.y)-c.y)*i,a>(l=((i>=0?e.y:d.y)-c.y)*i)||f>b?0:(f>a&&(a=f),l<b&&(b=l),g=((j>=0?d.z:e.z)-c.z)*j,a>(m=((j>=0?e.z:d.z)-c.z)*j)||g>b?0:(g>a&&(a=g),m<b&&(b=m),b<0?0:a>=0?a:b))}},a.RenderTarget=p,a.Renderer=class{constructor({canvas:a=document.createElement("canvas"),width:g=300,height:h=150,dpr:i=1,alpha:c=!1,depth:d=!0,stencil:e=!1,antialias:j=!1,premultipliedAlpha:f=!1,preserveDrawingBuffer:k=!1,powerPreference:l="default",autoClear:m=!0,webgl:n=2}={}){let b={alpha:c,depth:d,stencil:e,antialias:j,premultipliedAlpha:f,preserveDrawingBuffer:k,powerPreference:l};this.dpr=i,this.alpha=c,this.color=!0,this.depth=d,this.stencil=e,this.premultipliedAlpha=f,this.autoClear=m,2===n&&(this.gl=a.getContext("webgl2",b)),this.isWebgl2=!!this.gl,this.gl||(this.gl=a.getContext("webgl",b)||a.getContext("experimental-webgl",b)),this.gl.renderer=this,this.setSize(g,h),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES")}setSize(a,b){this.width=a,this.height=b,this.gl.canvas.width=a*this.dpr,this.gl.canvas.height=b*this.dpr,Object.assign(this.gl.canvas.style,{width:a+"px",height:b+"px"})}setViewport(a,b){this.state.viewport.width===a&&this.state.viewport.height===b||(this.state.viewport.width=a,this.state.viewport.height=b,this.gl.viewport(0,0,a,b))}enable(a){!0!==this.state[a]&&(this.gl.enable(a),this.state[a]=!0)}disable(a){!1!==this.state[a]&&(this.gl.disable(a),this.state[a]=!1)}setBlendFunc(a,b,c,d){this.state.blendFunc.src===a&&this.state.blendFunc.dst===b&&this.state.blendFunc.srcAlpha===c&&this.state.blendFunc.dstAlpha===d||(this.state.blendFunc.src=a,this.state.blendFunc.dst=b,this.state.blendFunc.srcAlpha=c,this.state.blendFunc.dstAlpha=d,void 0!==c?this.gl.blendFuncSeparate(a,b,c,d):this.gl.blendFunc(a,b))}setBlendEquation(a,b){this.state.blendEquation.modeRGB===a&&this.state.blendEquation.modeAlpha===b||(this.state.blendEquation.modeRGB=a,this.state.blendEquation.modeAlpha=b,void 0!==b?this.gl.blendEquationSeparate(a,b):this.gl.blendEquation(a))}setCullFace(a){this.state.cullFace!==a&&(this.state.cullFace=a,this.gl.cullFace(a))}setFrontFace(a){this.state.frontFace!==a&&(this.state.frontFace=a,this.gl.frontFace(a))}setDepthMask(a){this.state.depthMask!==a&&(this.state.depthMask=a,this.gl.depthMask(a))}setDepthFunc(a){this.state.depthFunc!==a&&(this.state.depthFunc=a,this.gl.depthFunc(a))}activeTexture(a){this.state.activeTextureUnit!==a&&(this.state.activeTextureUnit=a,this.gl.activeTexture(this.gl.TEXTURE0+a))}bindFramebuffer({target:b=this.gl.FRAMEBUFFER,buffer:a=null}={}){this.state.framebuffer!==a&&(this.state.framebuffer=a,this.gl.bindFramebuffer(b,a))}getExtension(a,b,c){return b&&this.gl[b]?this.gl[b].bind(this.gl):(this.extensions[a]||(this.extensions[a]=this.gl.getExtension(a)),b?this.extensions[a][c].bind(this.extensions[a]):this.extensions[a])}sortOpaque(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.program.id!==b.program.id?a.program.id-b.program.id:a.zDepth!==b.zDepth?a.zDepth-b.zDepth:b.id-a.id}sortTransparent(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.zDepth!==b.zDepth?b.zDepth-a.zDepth:b.id-a.id}sortUI(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.program.id!==b.program.id?a.program.id-b.program.id:b.id-a.id}getRenderList({scene:f,camera:b,frustumCull:g,sort:h}){let a=[];if(b&&g&&b.updateFrustum(),f.traverse(c=>{if(!c.visible)return!0;c.draw&&(g&&c.frustumCulled&&b&&!b.frustumIntersectsMesh(c)||a.push(c))}),h){let c=[],d=[],e=[];a.forEach(a=>{a.program.transparent?a.program.depthTest?d.push(a):e.push(a):c.push(a),a.zDepth=0,0===a.renderOrder&&a.program.depthTest&&b&&(a.worldMatrix.getTranslation(K),K.applyMatrix4(b.projectionViewMatrix),a.zDepth=K.z)}),c.sort(this.sortOpaque),d.sort(this.sortTransparent),e.sort(this.sortUI),a=c.concat(d,e)}return a}render({scene:c,camera:b,target:a=null,update:e=!0,sort:f=!0,frustumCull:g=!0,clear:d}){null===a?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(a),this.setViewport(a.width,a.height)),(d||this.autoClear&& !1!==d)&&(!this.depth||a&&a.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),e&&c.updateMatrixWorld(),b&&null===b.parent&&b.updateMatrixWorld(),this.getRenderList({scene:c,camera:b,frustumCull:g,sort:f}).forEach(a=>{a.draw({camera:b})})}},a.Skin=class extends n{constructor(a,{rig:b,geometry:c,program:d,mode:e=a.TRIANGLES}={}){super(a,{geometry:c,program:d,mode:e}),this.createBones(b),this.createBoneTexture(),this.animations=[],Object.assign(this.program.uniforms,{boneTexture:{value:this.boneTexture},boneTextureSize:{value:this.boneTextureSize}})}createBones(a){if(this.root=new g,this.bones=[],a.bones&&a.bones.length){for(let b=0;b<a.bones.length;b++){let d=new g;d.position.fromArray(a.bindPose.position,3*b),d.quaternion.fromArray(a.bindPose.quaternion,4*b),d.scale.fromArray(a.bindPose.scale,3*b),this.bones.push(d)}a.bones.forEach((a,b)=>{if(this.bones[b].name=a.name,-1===a.parent)return this.bones[b].setParent(this.root);this.bones[b].setParent(this.bones[a.parent])}),this.root.updateMatrixWorld(!0),this.bones.forEach(a=>{a.bindInverse=new c(...a.worldMatrix).inverse()})}}createBoneTexture(){if(!this.bones.length)return;let a=Math.max(4,Math.pow(2,Math.ceil(Math.log(Math.sqrt(4*this.bones.length))/Math.LN2)));this.boneMatrices=new Float32Array(a*a*4),this.boneTextureSize=a,this.boneTexture=new o(this.gl,{image:this.boneMatrices,generateMipmaps:!1,type:this.gl.FLOAT,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA16F:this.gl.RGBA,flipY:!1,width:a})}addAnimation(b){let a=new s({objects:this.bones,data:b});return this.animations.push(a),a}update(){let a=0;this.animations.forEach(b=>a+=b.weight),this.animations.forEach((b,c)=>{b.update(a,0===c)})}draw({camera:a}={}){this.root.updateMatrixWorld(!0),this.bones.forEach((a,b)=>{ap.multiply(a.worldMatrix,a.bindInverse),this.boneMatrices.set(ap,16*b)}),this.boneTexture&&(this.boneTexture.needsUpdate=!0),super.draw({camera:a})}},a.Sphere=class extends f{constructor(F,{radius:p=.5,widthSegments:u=16,heightSegments:G=Math.ceil(.5*u),phiStart:H=0,phiLength:I=2*Math.PI,thetaStart:J=0,thetaLength:K=Math.PI,attributes:v={}}={}){let h=u,f=G,w=H,x=I,i=J,k=K,l=(h+1)*(f+1),y=h*f*6,m=new Float32Array(3*l),n=new Float32Array(3*l),q=new Float32Array(2*l),e=l>65536?new Uint32Array(y):new Uint16Array(y),a=0,L=0,c=0,M=i+k,j=[],_=new b;for(let r=0;r<=f;r++){let z=[],o=r/f;for(let s=0;s<=h;s++,a++){let t=s/h,A=-p*Math.cos(w+t*x)*Math.sin(i+o*k),B=p*Math.cos(i+o*k),C=p*Math.sin(w+t*x)*Math.sin(i+o*k);m[3*a]=A,m[3*a+1]=B,m[3*a+2]=C,_.set(A,B,C).normalize(),n[3*a]=_.x,n[3*a+1]=_.y,n[3*a+2]=_.z,q[2*a]=t,q[2*a+1]=1-o,z.push(L++)}j.push(z)}for(let d=0;d<f;d++)for(let g=0;g<h;g++){let N=j[d][g+1],D=j[d][g],O=j[d+1][g],E=j[d+1][g+1];(0!==d||i>0)&&(e[3*c]=N,e[3*c+1]=D,e[3*c+2]=E,c++),(d!==f-1||M<Math.PI)&&(e[3*c]=D,e[3*c+1]=O,e[3*c+2]=E,c++)}Object.assign(v,{position:{size:3,data:m},normal:{size:3,data:n},uv:{size:2,data:q},index:{data:e}}),super(F,v)}},a.Text=function({font:a,text:d,width:e=1/0,align:f="left",size:g=1,letterSpacing:h=0,lineHeight:i=1.4,wordSpacing:j=0,wordBreak:k=!1}){let l=this,b,m,n,o,p,q=/\n/,r=/\s/;function c(){n=a.common.lineHeight,o=a.common.base,p=g/o;let c=d.replace(/[ \n]/g,"").length;m={position:new Float32Array(4*c*3),uv:new Float32Array(4*c*2),id:new Float32Array(4*c),index:new Uint16Array(6*c)};for(let b=0;b<c;b++)m.id[b]=b,m.index.set([4*b,4*b+2,4*b+1,4*b+1,4*b+2,4*b+3],6*b);s()}function s(){let y=[],n=0,u=0,o=0,c=w();function w(){let a={width:0,glyphs:[]};return y.push(a),u=n,o=0,a}let z=0;for(;n<d.length&&z<100;){z++;let v=d[n];if(!c.width&&r.test(v)){u=++n,o=0;continue}if(q.test(v)){n++,c=w();continue}let x=b[v];if(c.glyphs.length){let C=c.glyphs[c.glyphs.length-1][0],A=t(x.id,C.id)*p;c.width+=A,o+=A}c.glyphs.push([x,c.width]);let s=0;if(r.test(v)?(u=n,o=0,s+=j*g):s+=h*g,s+=x.xadvance*p,c.width+=s,o+=s,c.width>e){if(k&&c.glyphs.length>1){c.width-=s,c.glyphs.pop(),c=w();continue}if(!k&&o!==c.width){let B=n-u+1;c.glyphs.splice(-B,B),n=u,c.width-=o,c=w();continue}}n++}c.width||y.pop(),function(n){let s=a.common.scaleW,t=a.common.scaleH,c=.07*g,o=0;for(let q=0;q<n.length;q++){let e=n[q];for(let h=0;h<e.glyphs.length;h++){let b=e.glyphs[h][0],d=e.glyphs[h][1];if("center"===f?d-=.5*e.width:"right"===f&&(d-=e.width),r.test(b.char))continue;d+=b.xoffset*p,c-=b.yoffset*p;let u=b.width*p,v=b.height*p;m.position.set([d,c-v,0,d,c,0,d+u,c-v,0,d+u,c,0],4*o*3);let j=b.x/s,w=b.width/s,k=1-b.y/t,x=b.height/t;m.uv.set([j,k-x,j,k,j+w,k-x,j+w,k],4*o*2),c+=b.yoffset*p,o++}c-=g*i}l.buffers=m,l.numLines=n.length,l.height=l.numLines*g*i}(y)}function t(c,e){for(let d=0;d<a.kernings.length;d++){let b=a.kernings[d];if(!(b.first<c||b.second<e))return b.first>c?0:b.first===c&&b.second>e?0:b.amount}return 0}b={},a.chars.forEach(a=>b[a.char]=a),c(),this.resize=function(a){({width:e}=a),s()},this.update=function(a){({text:d}=a),c()}},a.Texture=o,a.Transform=g,a.Vec2=e,a.Vec3=b,a.Vec4=class extends Array{constructor(a=0,b=a,c=a,d=a){return super(a,b,c,d),this}get x(){return this[0]}set x(a){this[0]=a}get y(){return this[1]}set y(a){this[1]=a}get z(){return this[2]}set z(a){this[2]=a}get w(){return this[3]}set w(a){this[3]=a}set(a,b,c,d){return a.length?this.copy(a):(j(this,a,b,c,d),this)}copy(a){return i(this,a),this}normalize(){return k(this,this),this}fromArray(a,b=0){return this[0]=a[b],this[1]=a[b+1],this[2]=a[b+2],this[3]=a[b+3],this}toArray(a=[],b=0){return a[b]=this[0],a[b+1]=this[1],a[b+2]=this[2],a[b+3]=this[3],a}},a}({})